include(FindPackageHandleStandardArgs)

if (MSVC)
	set(mariadb_connector_c_name mariadb)
else()
	set(mariadb_connector_c_name libmariadb)
endif()

find_path(MARIADB_CLIENT_INCLUDE_DIR
	NAMES mysql.h mariadb_version.h
	PATH_SUFFIXES mariadb
	NO_SYSTEM_ENVIRONMENT_PATH
	NO_CMAKE_SYSTEM_PATH)
find_library(MARIADB_CLIENT_LIBRARIES
	NAMES ${mariadb_connector_c_name} 
	PATH_SUFFIXES lib/mariadb
	NO_SYSTEM_ENVIRONMENT_PATH
	NO_CMAKE_SYSTEM_PATH)

if (MSVC AND BUILD_SHARED_LIBS)
	find_path(MARIADB_CLIENT_RUNTIMES
		NAMES ${mariadb_connector_c_name}.dll
		PATH_SUFFIXES lib/mariadb
		NO_SYSTEM_ENVIRONMENT_PATH
		NO_CMAKE_SYSTEM_PATH)
	find_package_handle_standard_args(MARIADB_CLIENT REQUIRED_VARS
		MARIADB_CLIENT_INCLUDE_DIR
		MARIADB_CLIENT_LIBRARIES
		MARIADB_CLIENT_RUNTIMES)
else()
	find_package_handle_standard_args(MARIADB_CLIENT REQUIRED_VARS
		MARIADB_CLIENT_INCLUDE_DIR
		MARIADB_CLIENT_LIBRARIES)
endif()

if (MARIADB_CLIENT_FOUND)
	message("# find mariadb include dir: ${MARIADB_CLIENT_INCLUDE_DIR}")
	message("# find mariadb libraries: ${MARIADB_CLIENT_LIBRARIES}")
	if (MSVC AND BUILD_SHARED_LIBS)
		message("# find mariadb runtimes: ${MARIADB_CLIENT_RUNTIMES}")
	endif()
else()
	message("${MARIADB_CLIENT_INCLUDE_DIR}")
	message("${MARIADB_CLIENT_LIBRARIES}")
	message(FATAL_ERROR "Failed found mariadb")
endif()

SET(MARIADB_CLIENT_TARGET_NAME maridbclient)
if (BUILD_SHARED_LIBS)
	add_library(${MARIADB_CLIENT_TARGET_NAME} SHARED IMPORTED)
else()
	add_library(${MARIADB_CLIENT_TARGET_NAME} STATIC IMPORTED)
endif()

if (MSVC)
	if (BUILD_SHARED_LIBS)
		set_target_properties(${MARIADB_CLIENT_TARGET_NAME} PROPERTIES
			IMPORTED_IMPLIB "${MARIADB_CLIENT_LIBRARIES}"
			IMPORTED_LOCATION "${MARIADB_CLIENT_RUNTIMES}"
			INTERFACE_INCLUDE_DIRECTORIES "${MARIADB_CLIENT_INCLUDE_DIR}")
	else()
		set_target_properties(${MARIADB_CLIENT_TARGET_NAME} PROPERTIES
			IMPORTED_IMPLIB "${MARIADB_CLIENT_LIBRARIES}"
			IMPORTED_LOCATION "${MARIADB_CLIENT_LIBRARIES}"
			INTERFACE_INCLUDE_DIRECTORIES "${MARIADB_CLIENT_INCLUDE_DIR}")
	endif()
else()
	set_target_properties(${MARIADB_CLIENT_TARGET_NAME} PROPERTIES
		IMPORTED_IMPLIB "${MARIADB_CLIENT_LIBRARIES}"
		IMPORTED_LOCATION "${MARIADB_CLIENT_LIBRARIES}"
		INTERFACE_INCLUDE_DIRECTORIES "${MARIADB_CLIENT_INCLUDE_DIR}")
endif()
